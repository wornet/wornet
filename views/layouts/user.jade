extends ../layouts/wornet

include ../includes/notifications

mixin friends(classes)
	- var loggedFriends = user.friends.find({ present: true })
	ul.nav(class=classes): li.loggedFriends
		a.dropdown-toggle(href="#" data-toggle="dropdown")
			span.mobile
				+glyph('th-large')
				| &nbsp; 
			span
				=s("Amis connectés")
				| &nbsp; 
				span.pill
					=loggedFriends.length
		ul.dropdown-menu(role='menu' ng-controller="ProfileCtrl")
			if loggedFriends.length > 0
				each friend, id in loggedFriends
					- friend = objectToUser(friend).publicInformations()
					li: a(ng-click="chatWith(" + JSON.stringify(friend) + ")")
						img.thumb(src=friend.thumb50 alt=friend.name.full)
						| &nbsp; 
						=friend.name.full
						| &nbsp; 
						+glyph('comment')


block params
	- var bodyClasses = null

block nav
	include ../includes/shutter
	nav#navbar.navbar-fixed-top.nav.navbar(role='navigation' class=(user.openedShutter ? 'opened-shutter' : false)): .container-fluid
		h1.col-xs-12
			!=upperTitle
		.navbar-header
			if user
				button.navbar-toggle.collapsed(type='button' data-toggle='collapse' data-target='#mainLinks')
					span.sr-only Toggle navigation
					span.icon-bar
					span.icon-bar
					span.icon-bar
			a.navbar-brand(href='#')
				!=upperTitle
		if user
			#mainLinks.collapse.navbar-collapse
				ul.nav.navbar-nav.navbar-left.col-sm-6
					li: a(href="/")
						+glyph("home")
						| &nbsp; 
						=s("Accueil")
					li: a(href="/" data-click-alert!=s("Le regroupement des fils de conversation arrivera dans les prochains mois. Vous pouvez néanmoins d'ores et déjà échanger avec vos amis en ouvrant un chat privé directement depuis la barre de recherche, la fonction &quot;amis connectés&quot; ou le profil de votre ami."))
						+glyph("envelope")
						| &nbsp; 
						=s("Messagerie")
					li.mobile: +notifications()
					li.mobile: +friends()
				ul.nav.navbar-nav.navbar-right
					li.btn-group
						a.dropdown-toggle(href="#" data-toggle="dropdown")
							span.mobile
								+glyph('user')
								| &nbsp; 
							=user.fullName
							|&nbsp;
							span.caret
						ul.dropdown-menu(role='menu')
							li: a(href="/user/profile")
									=s("Mon profil")
							li: a(href="/agenda")
									=s("Mon agenda")
							li: a(href="/user/logout")
									=s("Déconnexion")
					li.open-shutter: a(href="#")
						+glyph("list")
						span.mobile
							| &nbsp; 
							=s("Options")

	if user
		nav#underbar.nav.navbar.cb
			+notifications('desktop navbar-nav navbar-left col-sm-4 col-xs-12')
			+form("{{ query.action }}")(ng-controller="SearchCtrl" role="search" ng-submit="search(query)").loading.navbar-form.navbar-left.col-sm-4.col-xs-12
				label.search
					+formControl()(
						ng-model="query.content"
						ng-change="change(query)"
						placeholder=s("Recherchez vos amis")
						)#search
					+glyph('search')
				.suggests
					ul: li(ng-repeat="user in query.users")
						a.col-xs-9(href="/user/profile/{{ user.hashedId }}/{{ user.name.full | urlencode }}")
							img(ng-src="{{ user.thumb50 }}" alt="{{ user.name.full }}" data-id="{{ user.hashedId }}" data-toggle="tooltip" data-placement="top" title="{{ user.name.full }}").thumb
							| {{ user.name.full }}
						a.col-xs-3.chat-with(ng-click="chatWith(user)" ng-if="user.isAFriend")
							+glyph('comment')
						a.col-xs-3.chat-with(
							ng-if="! user.isAFriend && ! user.askedForFriend"
							href="/user/friend/{{ user.hashedId }}/{{ user.name.full | urlencode }}"
							data-target=".errors"
							data-click="success"
							data-param0=s("Demande envoyée à {{ user.name.full }}")
							data-ask-for-friend="{{ user.hashedId }}"
						)
							+glyph('plus')
						span.col-xs-3.chat-with(ng-if="user.isAFriend && ! user.askedForFriend")
			+friends('desktop navbar-nav navbar-right')
	else
		.main-padding

block footer
	include ../includes/chat
	include ../includes/media-viewer

block cookie-banner-under
